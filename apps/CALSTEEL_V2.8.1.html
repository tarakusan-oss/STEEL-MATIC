<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CALSTEEL V.2.8.1 | STEEL-MATIC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f8fafc; color: #1e293b; font-family: 'Sarabun', sans-serif; }
        .app-card { background: white; border-radius: 2rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05); }
        .input-field { background: #f1f5f9; border: 2px solid transparent; transition: all 0.2s; color: #0f172a; font-weight: 700; }
        .input-field:focus { border-color: #3b82f6; background: white; outline: none; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
        .btn-main { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; transition: all 0.2s; }
        .btn-main:active { transform: scale(0.98); }
        .label-text { color: #64748b; font-size: 0.75rem; font-weight: 700; margin-left: 0.5rem; margin-bottom: 0.25rem; display: block; }
    </style>
</head>
<body class="min-h-screen p-4 pb-20">
    
    <nav class="max-w-md mx-auto mb-6 flex justify-between items-center">
        <a href="../index.html" class="bg-white px-4 py-2 rounded-xl text-xs text-blue-600 flex items-center gap-2 shadow-sm border border-slate-200 hover:bg-slate-50 transition-all font-bold">
            <i class="fas fa-arrow-left"></i> กลับไปที่ Dashboard
        </a>
        <span class="text-[10px] text-slate-400 font-mono font-bold">V.2.8.1-STEELMATIC</span>
    </nav>

    <div id="app" class="max-w-md mx-auto">
        
        <div class="text-center mb-8">
            <div class="inline-block p-3 bg-blue-100 rounded-2xl mb-3">
                <i class="fas fa-calculator text-2xl text-blue-600"></i>
            </div>
            <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">ระบบคำนวณเหล็ก</h1>
            <p class="text-slate-500 text-sm font-medium">Precision Management Hub</p>
        </div>

        <div id="mainMenu" class="grid gap-4">
            <button onclick="showCalculator('weight')" class="app-card p-6 flex items-center gap-5 hover:bg-blue-50/50 transition-all border border-transparent hover:border-blue-200 group">
                <div class="w-14 h-14 bg-blue-100 rounded-2xl flex items-center justify-center text-blue-600 group-hover:scale-110 transition-transform"><i class="fas fa-weight-hanging text-2xl"></i></div>
                <div class="text-left">
                    <h3 class="font-bold text-slate-800 text-lg">น้ำหนักเหล็กแผ่น</h3>
                    <p class="text-xs text-slate-400 font-medium text-balance">CR, GI, EG, GZ, AL, HR, SL</p>
                </div>
            </button>
            <button onclick="showCalculator('slit')" class="app-card p-6 flex items-center gap-5 hover:bg-cyan-50/50 transition-all border border-transparent hover:border-cyan-200 group">
                <div class="w-14 h-14 bg-cyan-100 rounded-2xl flex items-center justify-center text-cyan-600 group-hover:scale-110 transition-transform"><i class="fas fa-scroll text-2xl"></i></div>
                <div class="text-left">
                    <h3 class="font-bold text-slate-800 text-lg">คำนวณเหล็ก SLIT</h3>
                    <p class="text-xs text-slate-400 font-medium">คำนวณ OD, ความยาว, น้ำหนักย้อนกลับ</p>
                </div>
            </button>
        </div>

        <div id="weightCalculator" style="display: none;" class="app-card p-8 border border-slate-100">
            <button onclick="showMainMenu()" class="text-slate-400 mb-6 flex items-center gap-2 text-sm font-bold hover:text-blue-500 transition-colors"><i class="fas fa-chevron-left"></i> ย้อนกลับ</button>
            
            <div class="space-y-5">
                <div>
                    <label class="label-text">ประเภทเหล็ก</label>
                    <select id="steelType" onchange="updateCoatingAndGrade()" class="w-full p-4 rounded-2xl input-field"></select>
                </div>
                
                <div id="coatingGroup">
                    <label class="label-text">ชั้นเคลือบ</label>
                    <select id="coating" class="w-full p-4 rounded-2xl input-field"></select>
                </div>
                
                <div id="gradeGroup" style="display:none;">
                    <label class="label-text">เกรด (ความหนาแน่น)</label>
                    <select id="grade" class="w-full p-4 rounded-2xl input-field"></select>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div><label class="label-text">ความหนา (mm)</label>
                        <input type="number" id="thickness" step="any" placeholder="0.00" class="w-full p-4 rounded-2xl input-field"></div>
                    <div><label class="label-text">กว้าง (mm)</label>
                        <input type="number" id="width" step="any" placeholder="0" class="w-full p-4 rounded-2xl input-field"></div>
                </div>

                <div><label class="label-text">ความยาว (mm)</label>
                    <input type="number" id="length" step="any" placeholder="0" class="w-full p-4 rounded-2xl input-field"></div>

                <div class="p-1 bg-slate-100 rounded-2xl flex gap-1">
                    <div class="flex-1 bg-white p-4 rounded-xl border border-blue-100 shadow-sm text-center">
                        <label class="text-[10px] uppercase tracking-wider text-blue-500 font-black">จำนวน (แผ่น)</label>
                        <input type="number" id="numSheets" step="any" class="w-full text-center text-xl font-black text-slate-800 focus:outline-none bg-transparent">
                    </div>
                    <div class="flex-1 bg-white p-4 rounded-xl border border-emerald-100 shadow-sm text-center">
                        <label class="text-[10px] uppercase tracking-wider text-emerald-500 font-black">น้ำหนักรวม (kg)</label>
                        <input type="number" id="totalWeight" step="any" class="w-full text-center text-xl font-black text-slate-800 focus:outline-none bg-transparent">
                    </div>
                </div>

                <button onclick="calculateWeight()" class="btn-main w-full p-5 rounded-2xl font-black text-lg shadow-blue-200 shadow-lg flex items-center justify-center gap-3">
                    <i class="fas fa-bolt"></i> คำนวณข้อมูล
                </button>
                <div id="weightResult" class="mt-4 p-5 rounded-2xl bg-slate-900 text-center font-bold text-white shadow-inner"></div>
            </div>
        </div>

        <div id="slitCalculator" style="display: none;" class="app-card p-8 border border-slate-100">
            <button onclick="showMainMenu()" class="text-slate-400 mb-6 flex items-center gap-2 text-sm font-bold hover:text-cyan-600 transition-colors"><i class="fas fa-chevron-left"></i> ย้อนกลับ</button>
            
            <div class="space-y-5">
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="label-text">ประเภทเหล็ก</label>
                        <select id="slitSteelType" onchange="updateSlitCoating()" class="w-full p-4 rounded-2xl input-field text-sm"></select></div>
                    <div><label class="label-text">เคลือบ/เกรด</label>
                        <select id="slitCoating" class="w-full p-4 rounded-2xl input-field text-sm"></select></div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div><label class="label-text">หนา (mm)</label>
                        <input type="number" id="slitThickness" step="any" class="w-full p-4 rounded-2xl input-field"></div>
                    <div><label class="label-text">หน้ากว้าง (mm)</label>
                        <input type="number" id="slitWidth" step="any" class="w-full p-4 rounded-2xl input-field"></div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div><label class="label-text">น้ำหนัก (kg)</label>
                        <input type="number" id="slitWeight" step="any" class="w-full p-4 rounded-2xl input-field"></div>
                    <div><label class="label-text">ID (mm)</label>
                        <input type="number" id="slitId" placeholder="508" class="w-full p-4 rounded-2xl input-field"></div>
                </div>

                <div class="bg-orange-50 p-5 rounded-2xl border border-orange-100">
                    <label class="block text-center text-[10px] font-black uppercase text-orange-500 mb-2 tracking-widest">ปรับค่าเพื่อคำนวณย้อนกลับ</label>
                    <div class="flex items-center gap-3">
                        <span class="font-bold text-orange-400">OD:</span>
                        <input type="number" id="slitOd" step="any" class="w-full p-4 rounded-xl !bg-white border-2 !border-orange-200 text-orange-700 text-xl text-center font-black" oninput="recalculateWeight()">
                    </div>
                </div>

                <div><label class="label-text text-center">ความยาวรวม (เมตร)</label>
                    <input type="number" id="slitLength" step="any" class="w-full p-5 rounded-2xl input-field !bg-cyan-50 border-2 !border-cyan-100 text-cyan-700 text-2xl text-center font-black"></div>

                <button onclick="calculateSlit()" class="btn-main !from-cyan-500 !to-blue-600 w-full p-5 rounded-2xl font-black text-lg shadow-lg">
                    ยืนยันการคำนวณ
                </button>
                <div id="slitResult" class="mt-4 p-5 rounded-2xl bg-slate-900 text-center text-sm font-bold text-cyan-300 shadow-inner"></div>
            </div>
        </div>

    </div>

    <script>
        // --- LOGIC เดิมจาก V2.7.2 (ห้ามเปลี่ยน) ---
        const STEEL_TYPES = {
            'CR': { name: 'เหล็กรีดเย็น (CR)', density: 7.85, coatings: {'ไม่มีชั้นเคลือบ': 0} },
            'GI': {
                name: 'เหล็กชุบสังกะสี (GI)',
                density: 7.85,
                coatings: {
                    'Z06': 90, 'Z08': 120, 'Z10': 150, 'Z12': 183, 'Z15': 150,
                    'Z18': 244, 'Z20': 200, 'Z22': 305, 'Z25': 250, 'Z27': 381, 'F06': 90, 'F08': 120
                }
            },
            'EG': { name: 'เหล็กชุบสังกะสีด้วยไฟฟ้า (EG)', density: 7.85, coatings: {'E8/E8': 18, 'E16/E16': 36, 'E24/24': 54} },
            'GZ': {
                name: 'เหล็ก GZ (ZAM)',
                density: 7.85,
                coatings: { 'K06': 90, 'K08': 120, 'K10': 100, 'K12': 183, 'K14': 203, 'K18': 244 }
            },
            'AL': { name: 'เหล็กแผ่นเคลือบอลูมิเนียม (AL)', density: 7.85, coatings: {'80': 0, '120': 0} },
            'HR': { name: 'เหล็กรีดร้อน (HR)', density: 7.85, coatings: {'ไม่มีชั้นเคลือบ': 0} },
            'SL': {
                name: 'เหล็กสแตนเลส (SL)',
                density: 7.85,
                grades: { '304=7.93': 7.93, '430=7.75': 7.75, '442=7.7': 7.7 }
            }
        };

        function showMainMenu() {
            document.getElementById('weightCalculator').style.display = 'none';
            document.getElementById('slitCalculator').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'grid';
        }
        
        function showCalculator(type) {
            document.getElementById('mainMenu').style.display = 'none';
            if (type === 'weight') {
                document.getElementById('weightCalculator').style.display = 'block';
                populateSteelTypes('steelType');
                updateCoatingAndGrade();
            } else if (type === 'slit') {
                document.getElementById('slitCalculator').style.display = 'block';
                populateSteelTypes('slitSteelType');
                updateSlitCoating();
            }
        }

        function populateSteelTypes(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '';
            for (const [key, value] of Object.entries(STEEL_TYPES)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = value.name;
                select.appendChild(option);
            }
        }

        function updateCoatingAndGrade() {
            const steelType = document.getElementById('steelType').value;
            const coatingSelect = document.getElementById('coating');
            const gradeSelect = document.getElementById('grade');
            const coatingGroup = document.getElementById('coatingGroup');
            const gradeGroup = document.getElementById('gradeGroup');
            
            coatingSelect.innerHTML = '';
            gradeSelect.innerHTML = '';
            
            if (STEEL_TYPES[steelType].coatings) {
                populateOptions(coatingSelect, STEEL_TYPES[steelType].coatings);
                coatingGroup.style.display = 'block';
                gradeGroup.style.display = 'none';
            } else if (STEEL_TYPES[steelType].grades) {
                populateOptions(gradeSelect, STEEL_TYPES[steelType].grades);
                gradeGroup.style.display = 'block';
                coatingGroup.style.display = 'none';
            }
        }

        function updateSlitCoating() {
            const steelType = document.getElementById('slitSteelType').value;
            const coatingSelect = document.getElementById('slitCoating');
            coatingSelect.innerHTML = '';
            if (STEEL_TYPES[steelType].coatings) {
                populateOptions(coatingSelect, STEEL_TYPES[steelType].coatings);
            } else if (STEEL_TYPES[steelType].grades) {
                populateOptions(coatingSelect, STEEL_TYPES[steelType].grades);
            }
        }

        function populateOptions(selectElement, options) {
            for (const [key, value] of Object.entries(options)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key;
                selectElement.appendChild(option);
            }
        }

        function calculateWeight() {
            const steelType = document.getElementById('steelType').value;
            const coating = document.getElementById('coating').value;
            const grade = document.getElementById('grade').value;
            const thickness = parseFloat(document.getElementById('thickness').value);
            const width = parseFloat(document.getElementById('width').value);
            const length = parseFloat(document.getElementById('length').value);
            const numSheets = parseFloat(document.getElementById('numSheets').value);
            const totalWeight = parseFloat(document.getElementById('totalWeight').value);
        
            let density = STEEL_TYPES[steelType].density;
            if (steelType === 'SL') { density = STEEL_TYPES[steelType].grades[grade]; }
        
            let steelWeightPerMm = density * thickness;
            if (STEEL_TYPES[steelType].coatings) {
                const coatingWeight = STEEL_TYPES[steelType].coatings[coating] / 1000;
                steelWeightPerMm += coatingWeight;
            }
        
            const area = (width / 1000) * (length / 1000);
            const lastModified = document.activeElement.id;
        
            if (['thickness', 'width', 'length', 'numSheets'].includes(lastModified) || (lastModified !== 'totalWeight' && !isNaN(numSheets))) {
                let weight = steelWeightPerMm * area * numSheets;
                const finalWeight = Math.round(weight);
                document.getElementById('totalWeight').value = finalWeight;
                document.getElementById('weightResult').innerHTML = `<i class="fas fa-check-circle text-emerald-400"></i> น้ำหนักรวม: ${finalWeight.toLocaleString()} กก.`;
            } else if (lastModified === 'totalWeight') {
                const calculatedSheets = Math.round(totalWeight / (steelWeightPerMm * area));
                document.getElementById('numSheets').value = calculatedSheets;
                document.getElementById('weightResult').innerHTML = `<i class="fas fa-list-ol text-blue-400"></i> จำนวนแผ่น: ${calculatedSheets.toLocaleString()} แผ่น`;
            }
        }

        function calculateSlit() {
            const steelType = document.getElementById('slitSteelType').value;
            const coating = document.getElementById('slitCoating').value;
            const thickness = parseFloat(document.getElementById('slitThickness').value);
            const width = parseFloat(document.getElementById('slitWidth').value);
            const weight = parseFloat(document.getElementById('slitWeight').value);
            const id = parseFloat(document.getElementById('slitId').value);

            let density = STEEL_TYPES[steelType].density;
            if (steelType === 'SL') { density = STEEL_TYPES[steelType].grades[coating]; }

            const length = weight / (width / 1000) / density / thickness;
            const od = Math.sqrt((4 * weight) / (Math.PI * (density * 1000) * (width / 1000)) + (id / 1000)**2) * 1000;

            document.getElementById('slitOd').value = od.toFixed(2);
            document.getElementById('slitLength').value = length.toFixed(2);
            document.getElementById('slitResult').innerHTML = `OD = ${od.toFixed(1)} mm. | ยาว = ${length.toLocaleString()} m.`;
        }

        function recalculateWeight() {
            const steelType = document.getElementById('slitSteelType').value;
            const coating = document.getElementById('slitCoating').value;
            const thickness = parseFloat(document.getElementById('slitThickness').value);
            const width = parseFloat(document.getElementById('slitWidth').value);
            const id = parseFloat(document.getElementById('slitId').value);
            const od = parseFloat(document.getElementById('slitOd').value);

            let density = STEEL_TYPES[steelType].density;
            if (steelType === 'SL') { density = STEEL_TYPES[steelType].grades[coating]; }

            if (id && od) {
                const newWeight = (Math.PI * (density * 1000) * (width / 1000) * ((od / 1000)**2 - (id / 1000)**2)) / 4;
                const newLength = newWeight / (width / 1000) / density / thickness;
                document.getElementById('slitWeight').value = newWeight.toFixed(1);
                document.getElementById('slitLength').value = newLength.toFixed(0);
                document.getElementById('slitResult').innerHTML = `คำนวณย้อนจาก OD: Weight = ${newWeight.toFixed(1)} kg.`;
            }
        }

        function recalculateFromLength() {
            const steelType = document.getElementById('slitSteelType').value;
            const coating = document.getElementById('slitCoating').value;
            const thickness = parseFloat(document.getElementById('slitThickness').value);
            const width = parseFloat(document.getElementById('slitWidth').value);
            const id = parseFloat(document.getElementById('slitId').value);
            const length = parseFloat(document.getElementById('slitLength').value);

            let density = STEEL_TYPES[steelType].density;
            if (steelType === 'SL') { density = STEEL_TYPES[steelType].grades[coating]; }

            if (id && length) {
                const newWeight = length * (width / 1000) * thickness * density;
                const od = Math.sqrt((4 * newWeight) / (Math.PI * (density * 1000) * (width / 1000)) + (id / 1000)**2) * 1000;
                document.getElementById('slitWeight').value = newWeight.toFixed(1);
                document.getElementById('slitOd').value = od.toFixed(2);
                document.getElementById('slitResult').innerHTML = `คำนวณจากยาว: ${newWeight.toFixed(1)} kg. | OD: ${od.toFixed(1)}`;
            }
        }

        window.onload = function() {
            document.getElementById('slitLength').addEventListener('input', recalculateFromLength);
            ['thickness', 'width', 'length', 'numSheets', 'totalWeight'].forEach(id => {
                document.getElementById(id).addEventListener('keyup', e => { if(e.key==='Enter') calculateWeight(); });
            });
            ['slitThickness', 'slitWidth', 'slitWeight', 'slitId'].forEach(id => {
                document.getElementById(id).addEventListener('keyup', e => { if(e.key==='Enter') calculateSlit(); });
            });
        };
    </script>
</body>
</html>